{__NOLAYOUT__} 
<!DOCTYPE html>
<html lang="zh">
        <head>
                <meta charset="utf-8" />
                <title>仓储预警扫描 - Qing物流仓储系统</title>
                <meta name="description"
                      content="starry network" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <!--basic styles-->
                <link href="/Public/css/wh/bootstrap.min.css" rel="stylesheet" />
                <link rel="stylesheet" href="/Public/css/wh/font/css/font-awesome.min.css" />
                <!--[if IE 7]>
                            <link rel="stylesheet" href="/Public/css/wh/font/css/font-awesome-ie7.min.css" />
                        <![endif]-->
                <!--ace styles-->
                <link rel="stylesheet" href="/Public/css/wh/jquery-ui-1.10.3.custom.min.css" />
                <!--[if !IE]>-->
                <script type="text/javascript">
                        window.jQuery || document.write("<script src='/Public/js/wh/jquery-2.0.3.min.js'>" + "<" + "/script>");
                </script>
                <!--<![endif]-->
                <!--[if IE]>
                           <script type="text/javascript">
                               window.jQuery || document.write("<script src='/Public/js/wh/jquery-1.10.2.min.js'>" + "<" + "/script>");
                           </script>
                    <![endif]-->

                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
                <style>
                        .notice-text{color:red;}
                        .title-head{
                                font-size: 20px;
                                font-weight:900;
                                color:red;
                        }
                        #message-div{margin-top: 60px;}
                        #check_products{display:none;}
                        #check_normal{display:none;}
                        #check_custom_b{display:none;}
                        #check_custom_p{display:none;}
                </style>
        </head>
        <body>
                <div class="page-content">
                        <div class="page-header position-relative">
                                <h3>仓储预警扫描</h3>
                        </div>
                        <div class="col-md-offset-4 col-md-9">
                                <button class="btn btn-info" id="check_btn" type="button">
                                        <i class="icon-ok bigger-110"></i>
                                        开始扫描
                                </button>
                                &nbsp; &nbsp; &nbsp;
                                <button class="btn" id="reset_btn" type="reset">
                                        <i class="icon-undo bigger-110"></i>
                                        清空提示信息
                                </button>
                        </div>                        
                        <div id="message-div"></div>
                        <div class="col-xs-12">
                                <!-- PAGE CONTENT BEGINS -->
                                <div class="row" id="check_products">
                                        <div class="col-xs-12">
                                                <div class="table-responsive">
                                                        <div class="title-head">以下商品成功下单24小时后仍未出库：</div>
                                                        <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                                                                <thead>
                                                                        <tr>
                                                                                <th>订单号</th>
                                                                                <th>商品类型</th>
                                                                                <th>商品编号</th>
                                                                                <th>数量</th>
                                                                                <th>仓储进度</th>
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        创建时间
                                                                                </th>                                                                
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        更新时间
                                                                                </th>

                                                                        </tr>
                                                                </thead>

                                                                <tbody>
                                                                        <tr>
                                                                                <td>商品</td>
                                                                                <td>仓储</td>
                                                                                <td>进度</td>
                                                                                <td>一切</td>
                                                                                <td>正常</td>
                                                                                <td>--</td>
                                                                                <td class="hidden-480">
                                                                                        ##
                                                                                </td>
                                                                                <td class="hidden-480">
                                                                                        ##
                                                                                </td>                                                                
                                                                        </tr>
                                                                </tbody>
                                                        </table>
                                                </div><!-- /.table-responsive -->
                                        </div>                  
                                </div>

                                <div class="row" id="check_custom_p">
                                        <div class="col-xs-12">
                                                <div class="table-responsive">
                                                        <div class="title-head">以下已入库定制品在24小时内未出库：</div>
                                                        <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                                                                <thead>
                                                                        <tr>
                                                                                <th>定制区仓位</th>
                                                                                <th>货架号</th>
                                                                                <th>层</th>
                                                                                <th>列</th>
                                                                                <th>订单号</th>
                                                                                <th>商品编号</th>                                                             
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        更新时间
                                                                                </th>

                                                                        </tr>
                                                                </thead>

                                                                <tbody>
                                                                        <tr>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>                                                                                
                                                                                <td class="hidden-480">
                                                                                        ##
                                                                                </td>                                                                
                                                                        </tr>
                                                                </tbody>
                                                        </table>
                                                </div><!-- /.table-responsive -->
                                        </div>                  
                                </div>                                 

                                <div class="row" id="check_custom_b">
                                        <div class="col-xs-12">
                                                <div class="table-responsive">
                                                        <div class="title-head">以下定制区仓储位置已经至少空闲24小时：</div>
                                                        <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                                                                <thead>
                                                                        <tr>
                                                                                <th>定制区仓位</th>
                                                                                <th>货架号</th>
                                                                                <th>层</th>
                                                                                <th>列</th>                                                             
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        更新时间
                                                                                </th>

                                                                        </tr>
                                                                </thead>

                                                                <tbody>
                                                                        <tr>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td class="hidden-480">
                                                                                        ##
                                                                                </td>                                                                
                                                                        </tr>
                                                                </tbody>
                                                        </table>
                                                </div><!-- /.table-responsive -->
                                        </div>                  
                                </div>  


                                <div class="row" id="check_normal">
                                        <div class="col-xs-12">
                                                <div class="table-responsive">
                                                        <div class="title-head">以下普通商品品类库存低于预警数量100件：</div>
                                                        <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                                                                <thead>
                                                                        <tr>
                                                                                <th>品类ID</th>
                                                                                <th>品类名称</th>
                                                                                <th>当前库存</th>
                                                                                <th>最大库存</th>
                                                                                <th>累计入库</th>
                                                                                <th>累计出库</th>
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        创建时间
                                                                                </th>                                                                
                                                                                <th class="hidden-480">
                                                                                        <i class="icon-time bigger-110 hidden-480"></i>
                                                                                        更新时间
                                                                                </th>

                                                                        </tr>
                                                                </thead>

                                                                <tbody>
                                                                        <tr>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td></td>
                                                                                <td class="hidden-480">
                                                                                </td>
                                                                                <td class="hidden-480">
                                                                                </td>                                                                
                                                                        </tr>
                                                                </tbody>
                                                        </table>
                                                </div><!-- /.table-responsive -->
                                        </div>                  
                                </div>                                 
                        </div>
                </div>
                <script type="text/javascript">
                        window.jQuery || document.write("<script src='/Public/js/wh/jquery-2.0.3.min.js'>" + "<" + "/script>");
                </script>
                <!--basic scripts-->
                <script src="/Public/js/wh/bootstrap.min.js"></script>
                <!--page specific plugin scripts-->
                <script src="/Public/js/wh/jquery-ui-1.10.3.custom.min.js"></script>                  
                <!-- form validate -->
                <!--                <script src="/Public/js/wh/validate.js"></script>
                                <script src="/Public/js/wh/validata_message.js"></script>
                                <script src="/Public/js/wh/validata_metadata.js"></script>-->
                <script src="/Public/js/wh/wh.js"></script>    
                <script>
                        $(document).ready(function(){
                                $("#check_btn").click(function(){
                                        checkProduct();
                                        checkCustom();
                                        checkNormal();
                                });
                                $("#reset_btn").click(function(){
                                        init();
                                });
                        });
                        var init = function(){
                                $("#message-div").html('');
                                $("#check_products").hide();
                                $("#check_custom_p").hide();
                                $("#check_custom_b").hide();
                                $("#check_normal").hide();
                        }
                        var checkProduct = function () {
                                $.ajax({
                                        type: "post",
                                        url: "/Index/Checkout/toCheckProduct",
                                        dataType: "json",
                                        beforeSend :function(){
                                                $("#message-div").fn_tips("info", "ok", "开始请求扫描商品状态...");
                                        },
                                        error: function () {
                                                $("#message-div").fn_tips("warning", "exclamation", "请求失败，请重新操作或联系管理员");
                                                return false;
                                        },
                                        success: function (res) {
                                                if (res.status === 0) {
                                                        $("#message-div").fn_tips("warning", "exclamation", res.data);
                                                } else if (res.status === 1) {
                                                        var products = res.data;
                                                        var productsTr = '';
                                                        for (i in products) {
                                                                productsTr += '<tr><td>' + products[i]['orderno'] + '</td><td>' + products[i]['goods_type'] + '</td><td>' + products[i]['product_id'] + '</td><td>' + products[i]['count'] + '</td><td>' + products[i]['process'] + '</td><td class="hidden-480">' + products[i]['create_time'] + '</td><td class="hidden-480">' + products[i]['update_time'] + '</td></tr>';
                                                        }
                                                        $("#check_products").show();
                                                        $("#check_products table tbody").html('');
                                                        $("#check_products table tbody").append(productsTr);
                                                }
                                                $("#message-div").fn_tips("success", "ok", "完成商品状态扫描");
                                                return true;
                                        }
                                });
                        };
                        var checkCustom = function () {
                                $.ajax({
                                        type: "post",
                                        url: "/Index/Checkout/toCheckCustom",
                                        dataType: "json",
                                        beforeSend :function(){
                                                $("#message-div").fn_tips("info", "ok", "开始请求扫描定制区域...");
                                        },                                        
                                        error: function () {
                                                $("#message-div").fn_tips("warning", "exclamation", "请求失败，请重新操作或联系管理员");
                                                return false;
                                        },
                                        success: function (res) {
                                                if (res.status === 0) {
                                                        $("#message-div").fn_tips("warning", "exclamation", res.data);
                                                } else if (res.status === 1) {
                                                        var customs = res.data;
                                                        var pTr = '';
                                                        var bTr = '';
                                                        for (i in customs) {
                                                                if(customs[i]['orderno'] != ''){
                                                                        pTr += '<tr><td>'+customs[i]['location']+'</td><td>'+customs[i]['shelf']+'</td><td>'+customs[i]['layer']+'</td><td>'+customs[i]['col']+'</td><td>'+customs[i]['orderno']+'</td><td>'+customs[i]['product_id']+'</td><td class="hidden-480">'+customs[i]['update_time']+'</td></tr>';
                                                                }else{
                                                                        bTr += '<tr><td>'+customs[i]['location']+'</td><td>'+customs[i]['shelf']+'</td><td>'+customs[i]['layer']+'</td><td>'+customs[i]['col']+'</td><td class="hidden-480">'+customs[i]['update_time']+'</td></tr>';
                                                                }
                                                        }
                                                        $("#check_custom_p").show();
                                                        $("#check_custom_p table tbody").html('');
                                                        $("#check_custom_p table tbody").append(pTr);
                                                        $("#check_custom_b").show();
                                                        $("#check_custom_b table tbody").html('');
                                                        $("#check_custom_b table tbody").append(bTr);
                                                }
                                                $("#message-div").fn_tips("success", "ok", "完成定制区域扫描");
                                                return true;
                                        }
                                });
                        };
                        var checkNormal = function () {
                                $.ajax({
                                        type: "post",
                                        url: "/Index/Checkout/toCheckNormal",
                                        dataType: "json",
                                        beforeSend :function(){
                                                $("#message-div").fn_tips("info", "ok", "开始请求扫描普通品类库存...");
                                        },                                        
                                        error: function () {
                                                $("#message-div").fn_tips("warning", "exclamation", "请求失败，请重新操作或联系管理员");
                                                return false;
                                        },
                                        success: function (res) {
                                                if (res.status === 0) {
                                                        $("#message-div").fn_tips("warning", "exclamation", res.data);
                                                } else if (res.status === 1) {
                                                        var records = res.data;
                                                        var recordsTr = '';
                                                        for (i in records) {
                                                                recordsTr += '<tr><td>'+records[i]['category_id']+'</td><td>'+records[i]['category_name']+'</td><td><span class="notice-text">'+records[i]['cur_count']+'</span></td><td>'+records[i]['max_count']+'</td><td>'+records[i]['total_in_count']+'</td><td>'+records[i]['total_out_count']+'</td><td class="hidden-480">'+records[i]['create_time']+'</td><td class="hidden-480">'+records[i]['update_time']+'</td></tr>';
                                                        }
                                                        $("#check_normal").show();
                                                        $("#check_normal table tbody").html('');
                                                        $("#check_normal table tbody").append(recordsTr);
                                                }
                                                $("#message-div").fn_tips("success", "ok", "完成普通品类库存扫描");
                                                return true;
                                        }
                                });

                        };
                </script>
        </body>
</html>
